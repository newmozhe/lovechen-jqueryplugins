!function(a,b,c){var f={width:440,height:220},g=function(a,b){this.ele=a,this.options=c.extend(!0,{},f,b),this.ui={},this._init()};g.prototype={_init:function(){return this.options.icons.length<=0?(console.log("初始化表情选择器失败，必须配置icons"),!1):(this.initUi(),this.eventBind(),void 0)},initUi:function(){var e,f,g,h,i,j,k,l,m,n,o,p,q,a="",b="",d=0;for(e=0;e<this.options.icons.length;++e){if(f=this.options.icons[e],f.list||(f.list=new Array),f.nums&&f.nums.length>0)for(g=0,h=0,i=null,j=f.nums.length,k=f.extension||".jpg",l=f.path,1===j?h=f.nums[0]:2===j?(g=f.nums[0],h=f.nums[1]):(g=f.nums.shift(),h=f.nums.shift(),i=f.nums),m=g;h>=m;++m)i&&i.indexOf(m)>=0||f.list.push(l+m+k);if(0!=f.list.length){for(n=new Array,o="style='max-height:"+this.options.height+"px;",0!=d&&(o+="display:none;"),o+="'",n.push("<ul class='imglist'"),n.push(o),n.push(">"),p=0;p<f.list.length;++p)n.push('<li><img src="'),n.push(f.list[p]),n.push('"/></li>');n.push("</ul>"),a+=n.join(""),b+="<li"+(0==d?" class='currenttab'":"")+">"+f.name+"</li>",++d}else console.log("添加第"+(e+1)+"套表情包失败，没有有效表情")}return""===a?(alert("初始化表情选择器失败，错误代码：0x003"),!1):(q=d>1?this.options.height+28:this.options.height,this.id="liemoji_container_"+(this.options.panelid||(new Date).getTime()),a='<div class="liemoji_container" id="'+this.id+'" style="height:'+q+"px;width:"+this.options.width+'">'+a,d>1&&(a+="<div id='"+this.id+"_tab' class='liemoji_tab'><ul>"+b+"</ul></div>"),a+="</div>",c("#"+this.id).length>0&&c("#"+this.id).remove(),this.ele.after(a),this.ui.panel=c("#"+this.id),this.ui.tabbar=c("#"+this.id+"_tab"),void 0)},show:function(a){c(a.options.editor).focus();var d=this.ui.panel.outerHeight();this.ui.panel.css("left",a.ele.offset().left),this.ui.panel.css("top",b.documentElement.clientHeight<a.ele.offset().top+a.ele.outerHeight()+d?a.ele.offset().top-d:a.ele.offset().top+a.ele.outerHeight()),this.ui.panel.toggle()},eventBind:function(){var a=this;this.ele.click(function(){a.show(a)}),this.ui.panel.on("click","img",function(){var b="<img class='liemoji_icon' src="+c(this).attr("src")+" />";a.insertAtCursor(c(a.options.editor)[0],b,!1),a.show(a)}),this.ui.tabbar.on("click","ul li",function(){if(!c(this).hasClass("currentTab")){var b=c(this).index();c("#"+a.id+" .imglist:visible").hide(),c("#"+a.id+" .imglist").eq(b).show(),c("#"+a.id+"_tab .currenttab").removeClass("currenttab"),c(this).addClass("currenttab")}})},insertAtCursor:function(c,d,e){var f,g,h,j,k,i,l,m,n,o,p;if("DIV"===c.nodeName)if(c.focus(),a.getSelection){if(f=a.getSelection(),f.getRangeAt&&f.rangeCount){for(g=f.getRangeAt(0),g.deleteContents(),h=b.createElement("div"),h.innerHTML=d,i=b.createDocumentFragment();j=h.firstChild;)k=i.appendChild(j);l=i.firstChild,g.insertNode(i),k&&(g=g.cloneRange(),g.setStartAfter(k),e?g.setStartBefore(l):g.collapse(!0),f.removeAllRanges(),f.addRange(g))}}else(f=b.selection)&&"Control"!==f.type&&(m=f.createRange(),m.collapse(!0),f.createRange().pasteHTML(html),e&&(g=f.createRange(),g.setEndPoint("StartToStart",m),g.select()));else b.selection?(c.focus(),f=b.selection.createRange(),f.text=d,f.select()):c.selectionStart||0===c.selectionStart?(n=c.selectionStart,o=c.selectionEnd,p=c.scrollTop,c.value=c.value.substring(0,n)+d+c.value.substring(o,c.value.length),p>0&&(c.scrollTop=p),c.focus(),c.selectionStart=n+d.length,c.selectionEnd=n+d.length):(c.value+=d,c.focus())}},c.fn.liemoji=function(a){return new g(this,a),this}}(window,document,jQuery);